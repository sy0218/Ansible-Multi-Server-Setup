# -----------------------------------------------------
# cloud-init 비활성화
# -----------------------------------------------------
# cloud-init은 부팅 시 네트워크 / hostname / user 설정을
# 자동으로 변경할 수 있으므로 서버 고정 환경에서는 비활성화

- name: "Disable Cloud-Init"
  file:
    path: "{{ item.path }}"
    state: "{{ item.state }}"
    owner: root
    group: root
    mode: "{{ item.mode }}"
  loop:
    - { path: /etc/cloud, state: directory, mode: '0755' }
    - { path: /etc/cloud/cloud-init.disabled, state: touch, mode: '0644' }

# cloud-init 비활성화 플래그 파일 존재 여부 확인
- name: "Check.. cloud-init disabled flag file.."
  stat:
    path: /etc/cloud/cloud-init.disabled
  register: cloud_init_check

- name: "Status.. cloud-init.."
  debug:
    msg: "Good!.. | cloud-init is disabled.."
  when: cloud_init_check.stat.exists
